<!doctype html>
<html lang="en" ng-app="restylingApp">
<head>
	<meta charset="utf-8">
	<title>D3 Deconstructor</title>	
	
	<link rel="stylesheet" type="text/css" href="display.css" />
	<link rel="stylesheet" type="text/css" href="lib/bootstrap/css/bootstrap.min.css" />
	<link rel="stylesheet" type="text/css" href="lib/bootstrap/css/bootstrap-theme.min.css" />
	<link rel="stylesheet" type="text/css" href="lib/ng-table.css" />
	<script src="lib/raphael-min.js"></script>
	<script src="lib/angular.min.js"></script>
	<script src="lib/ui-utils.js"></script>
	<script src="lib/simple_statistics.js"></script>
	<script src="lib/ng-table.js"></script>
	<script src="lib/d3.v3.min.js"></script>
	<script src="lib/underscore-min.js"></script>
	<script src="lib/jquery.js"></script>
	<script src="lib/bootstrap/js/bootstrap.min.js"></script>
	<script src="lib/jquery.dataTables.js"></script>
	<script src="lib/dataTables.apiPlugins.js"></script>
	<script src="lib/jstat.js"></script>
	<script src="display.js"></script>
</head>
<body ng-controller="MappingListCtrl">

<div id="wrapper">
	<div id="sidebar-wrapper">
	<div class="well">
		<button ng-click="setChosenMappings()">Get Mappings</button>
		<button ng-click="addMappingDialog=true">Add Mapping</button>
	</div>
	<div class="panel-group" id="mappings" ng-if="addMappingDialog==false" ng-repeat="(dataAttr, mapped) in chosenMappings">
		<div class="panel panel-default" ng-repeat="mappedAttr in mapped">
			<a data-toggle="collapse" data-parent="#mappings" data-target="#{{(dataAttr + mappedAttr[0]).replace(' ','')}}">
				<div class="panel-heading">
					{{dataAttr}} to {{mappedAttr[0]}}
				</div>
			</a>
			<div id="{{(dataAttr + mappedAttr[0]).replace(' ','')}}" class="panel-collapse collapse" ng-if="!mappedAttr[1].hasOwnProperty('isNumericMapping')">
				<span>
					<div class="col-md-6 form-group">
						<label>{{dataAttr}}</label>
					</div>
					<div class="col-md-6 form-group">
						<label>{{mappedAttr[0]}}</label>
					</div>
					<span class="clearfix">
				</span>
				<span ng-repeat="(from, to) in mappedAttr[1]">
					<div class="col-md-6 form-group">
						<label>{{from}}</label>
					</div>
					<div class="col-md-6 form-group">
						<input class="form-control" ng-keypress="submitNominalMappingChange($event, dataAttr, mappedAttr[0], to[1])" ng-model="to[0][0]"></input>
					</div>
					<span class="clearfix">
				</span>
			</div>
			<div id="{{(dataAttr + mappedAttr[0]).replace(' ','')}}" class="panel-collapse collapse" ng-if="mappedAttr[1].hasOwnProperty('isNumericMapping')">
				<span>
					<div class="col-md-6 form-group">
						<label>{{dataAttr}}</label>
					</div>
					<div class="col-md-6 form-group">
						<label>{{mappedAttr[0]}}</label>
					</div>
					<span class="clearfix">
				</span>
				<span>
					<div class="col-md-6 form-group">
						<label>Min:</label>
					</div>
					<div class="col-md-6 form-group">
					</div>
					<span class="clearfix">
				</span>
				<span>
					<div class="col-md-6 form-group">
						<label>{{mappedAttr[1].dataMin}}</label>
					</div>
					<div class="col-md-6 form-group">
						<input ng-keypress="submitLinearMappingChange($event, dataAttr, mappedAttr)" ng-model="mappedAttr[1].visMin">
					</div>
					<span class="clearfix">
				</span>
				<span>
					<div class="col-md-6 form-group">
						<label>Max:</label>
					</div>
					<div class="col-md-6 form-group">
					</div>
					<span class="clearfix">
				</span>
				<span>
					<div class="col-md-6 form-group">
						<label>{{mappedAttr[1].dataMax}}</label>
					</div>
					<div class="col-md-6 form-group">
						<input ng-keypress="submitLinearMappingChange($event, dataAttr, mappedAttr)" ng-model="mappedAttr[1].visMax">
					</div>
					<span class="clearfix">
				</span>
			</div>
		</div>
	</div>
	<span ng-if="addMappingDialog">
		<div>
			<form>
				Choose Action:
				<select ng-model="addForm.action" ng-change="addFormActionChange()">
					<option value="valChange">Change Values</option>
					<option value="mapNominal">Add Nominal Mapping</option>
					<option value="mapLinear">Add Linear Mapping</option>
				</select>
				<span ng-if="addForm.action === 'valChange'">
					Select visual attribute:
					<select ng-model="addForm.changeAttr" ng-options="visAttr for visAttr in dataSets[currentDataSet].visSchema"></select>
					<span ng-if="addForm.changeAttr && (addForm.action === 'valChange')">
						Select value:
						<input ng-model="addForm.changedAttrValue">
						<br />
						<button ng-click="submitValChange()">Submit Change</button>
					</span>
				</span>
				
				<span ng-if="addForm.action === 'mapLinear'">
					   
				</span>
				
			</form>
		</div>
	</span>
</div>


<div class="page-content-wrapper">
<div class="page-content">
	<div class="container" ng-repeat="dataSet in dataSets | orderBy: '-numEls':false">
		<button ng-click="selectDataSet(dataSet)">Select</button>
		<table class="table">
			<thead>
				<tr>
					<th ng-repeat="(prop, val) in dataSet.d3Data">{{prop}}</th>
					<th>Mark</th>
				</tr>
			</thead>
			<tr ng-repeat="i in _.range(0, dataSet.numEls)" ng-click="toggleSelect($parent.$index, i)" ng-class="itemClass($parent.$index, i)">
				<td ng-repeat="(prop, val) in dataSet.d3Data">{{val[i]}}</td>
				<td svg-inject></td>
			</tr>
		</table>
	</div>
</div>
</div>
</body>
</html>